claude_code:
  binary_path: claude
  model: claude-sonnet-4-5-20250929
  night_start_hour: 1
  night_end_hour: 9
  threshold_day: 50.0
  threshold_night: 80.0
  usage_command: claude /usage

# Slack configuration
slack:
  # Default channel for notifications when task doesn't have a channel
  # (e.g., auto-generated tasks). Get channel ID by right-clicking channel
  # in Slack -> View channel details -> scroll to bottom for ID (starts with C)
  default_channel: C0A682MJT99  # Set to your channel ID, e.g., "C0123456789"

git:
  enabled: false  # Set to true to enable git commits and branching
  use_remote_repo: true
  remote_repo_url: git@github.com:TimeLovercc/test5.git # !!!CHANGE THIS!!!
  auto_create_repo: true

agent:
  workspace_root: ./workspace
  task_timeout_seconds: 1800

retry:
  max_attempts: 3  # Maximum total attempts (including first execution)
  base_delay_seconds: 30.0  # Initial delay before first retry
  max_delay_seconds: 3600.0  # Maximum delay between retries (1 hour)
  exponential_base: 2.0  # Multiplier for exponential backoff
  jitter_factor: 0.1  # Random jitter to prevent thundering herd (Â±10%)

multi_agent_workflow:
  planner:
    enabled: true
    max_turns: 10
  worker:
    enabled: true
    max_turns: 30
  evaluator:
    enabled: true
    max_turns: 10

# Human-in-the-loop checkpoints for approval before critical operations
checkpoints:
  enabled: true
  global_defaults:
    post_plan: false  # Require approval after planning phase
    pre_commit: true  # Require approval before committing changes
    pre_pr: true  # Require approval before creating pull requests
  timeout_minutes: 60  # How long to wait for approval
  timeout_behavior: notify  # proceed | abort | notify
  poll_interval_seconds: 5.0  # How often to check for approval

# Proactive progress notifications to Slack
notifications:
  enabled: true
  phase_notifications: true  # Notify on phase transitions (planning, executing, etc.)
  milestone_notifications: true  # Notify on significant milestones
  blocker_notifications: true  # Notify on blockers (rate limits, errors)
  heartbeat_enabled: true  # Send periodic "still working" signals
  heartbeat_interval_minutes: 10  # Minutes between heartbeat messages
  batch_window_seconds: 5.0  # Time window for batching rapid notifications
  min_phase_duration_seconds: 30.0  # Minimum time in phase before notifying

# Real-time task output streaming to Slack
streaming:
  enabled: true
  verbosity: normal  # off, minimal, normal, verbose
  update_interval_seconds: 2.0  # Minimum time between Slack message updates
  max_message_length: 35000  # Keep under Slack's 40k limit

# Task templates for common workflows
templates:
  enabled: true
  # Additional template directories (beyond builtin)
  user_templates_dir: ~/.sleepless/templates
  project_templates_dir: .sleepless/templates

# Codebase context injection for task prompts
context:
  enabled: true
  cache_ttl_minutes: 60  # How long to cache extracted context (1 hour)
  structure:
    enabled: true
    max_depth: 4  # Maximum directory depth to traverse
  conventions:
    enabled: true
  git:
    enabled: true
    commit_limit: 10  # Number of recent commits to include
    file_limit: 20  # Number of recently modified files to track

auto_generation:
  enabled: true
  # Uses engineering-lead or chief-of-staff to intelligently select next task
  use_agent: true
  agent_type: engineering-lead
  # Fallback to prompt-based generation when use_agent is false
  prompts:
    - name: strategic
      prompt: |-
        You are an engineering lead selecting the next highest-value task for this workspace.

        ## Current State
        - Active tasks: {task_count} ({pending_count} pending, {in_progress_count} in progress)

        ## Available Tasks to Refine
        {available_tasks}

        ## Recent Work & Context
        {recent_work}

        ## Decision Framework
        Analyze the workspace state and select ONE task using this priority order:

        1. **Complete in-progress work first** - Unfinished tasks block value delivery
        2. **Fix critical issues** - Bugs, failures, or blockers in existing work
        3. **Enhance high-value deliverables** - Improve quality of important outputs
        4. **Start strategic new work** - Only if existing work is solid

        ## Task Selection Criteria
        - Highest impact with reasonable effort
        - Builds on existing momentum and context
        - Advances project goals (check projects.yaml if available)
        - Avoids duplicating recent work
        - Concrete and actionable (not vague explorations)

        ## Workspace Constraints
        - Tasks execute in: workspace/tasks/<task_id>/
        - Access limited to: task folder + workspace/shared/
        - REFINE tasks reuse existing workspaces

        ## Output Format (CRITICAL)
        Output ONLY one line in this exact format:
        - To refine: [REFINE:#<task_id>] <specific improvement in 1-2 sentences>
        - For new: [NEW] <specific deliverable in 1-2 sentences>

        Be specific about WHAT will be delivered, not just what will be "explored" or "researched".
      weight: 1.0